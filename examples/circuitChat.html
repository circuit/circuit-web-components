<!DOCTYPE html>
<html>
  <head>
    <script src="//unpkg.com/circuit-sdk@latest/circuit.min.js" async></script>
    <script type="module" src="../circuit-chat.js" defer></script>
    <script type="module" src="../circuit-conversations-list.js" defer></script>
    <style>
      /* Global page styles which are inherited by element */
      body {
        font-family: sans-serif;
        font-size: 13px;
      }

      input {
        width: 150px;
        margin: 5px 0px 10px 0px;
      }

      .conversation-button-container { 
        padding-bottom: 20px;
        display: flex;
        align-items: center;
      }

      .conv-btn {
        margin-left: 20px;
      }

      .component-container {
        display: flex;
      }

      circuit-conversations-list::part(conversation-list) {
        width: 700px;
        max-height: 200px;
        border: 1px solid green;
        overflow-y: auto;
      }

      circuit-conversations-list::part(circuit-conversation) {
        height: 25px;
        display: flex;
        align-items: center;
        border-top: 1px solid #dadada;
      }


      circuit-chat {
        padding-left: 30px;
        /* Padding of the item content */
        --item-padding: 0 0 0 10px;
      }

      /* Style of the send button */
      circuit-chat::part(btn) {
        float: right;
        padding-left: 10px;
        margin-top: 15px;
      }

      /* Style of the input field */
      circuit-chat::part(inp) {
        width: 300px;
        margin-top: 15px;
      }

      /* Main container */
      circuit-chat::part(main-container) {
        width: 700px;
      }

      /* Conversation Title */
      .converation-list-title, circuit-chat::part(conversation-title) {
        padding-bottom: 10px;
        font-size: 24px;
      }

      /* Style of the conversation feed */
      circuit-chat::part(conversation-container) {
          height: 550px;
          border: 1px solid green;
          overflow-y: auto;
          word-break: break-word;
      }

      /* Style of each conversation item in the feed */
      circuit-chat::part(conversation-item) {
        padding:  10px 5px;
        border-top: 1px solid #dadada;
        display: flex;
        align-items: center;
        overflow-wrap: break-word;
      }

      /* Style of the display name in items feed */
      circuit-chat::part(circuit-name) {
        min-width: 90px;
      }

      /* Hide both until he components are finished loading */
      .hidden, circuit-chat.hidden, circuit-conversations-list.hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <h2>Circuit Conversations & Circuit Chat</h2>
    <p>Uses web component <code>circuit-conversations-list</code> to retrieve the conversation list.<br>
      Select a conversation from the list to display the conversation feed using the <code>circuit-chat</code> web component.
    </p>
    <div class="conversation-button-container">
      <div>Get Conversations</div>
      <button class="conv-btn" id="selectConv">Click</button>
    </div>
    <hr>

    <div class="component-container">
      <div id="conversation-list-container">
        <div id="converation-list-title" class="converation-list-title hidden">Conversations List</div>
        <circuit-conversations-list
          class="hidden"
          domain="circuitsandbox.net"
          clientId="f06c51a30f0d4eb6acc05829c3e86266"
          numberOfConversations="10"></circuit-conversations-list>
        <p>
          <a target="_blank" href="https://github.com/circuit/circuit-web-components/tree/master/docs">documentation</a> |
          <a target="_blank" href="https://github.com/circuit/circuit-web-components">github</a> |
          <a target="_blank" href="https://www.npmjs.com/package/@unify/circuit-web-components">npm</a>
        </p>
      </div>
      <circuit-chat
        class="hidden"
        domain="circuitsandbox.net"
        clientId="f06c51a30f0d4eb6acc05829c3e86266"
        initNumOfItems="40"
        sendOnEnter></circuit-chat>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const inputEl = document.querySelector('input');
        const convBtn = document.querySelector('#selectConv');
        const convEl = document.querySelector('circuit-chat');
        const convList = document.querySelector('circuit-conversations-list');
        const convListContainer = document.getElementById('converation-list-title');
        convBtn.addEventListener('click', () => convList.active = true);

        // Event Listeners

        // Conversation list finished loading event
        convList.addEventListener('loaded', evt => {
          const conversations = evt.detail; // Do something with conversations list here
          convList.classList.remove('hidden');
          convListContainer.classList.remove('hidden');
        });

        // Conversation selected event
        convList.addEventListener('selected', evt => {
          const conversation = evt.detail.conversation; // Do something with selected conversation here
          convEl.client = evt.detail.client; //  Same client as the Conversation List component
          convEl.convId = conversation.convId;
        });
  
        // Conversation finished loading event
        convEl.addEventListener('loaded', res => {
          const conversation = res.detail.conv; // Can do something with the conversation here
          convEl.classList.remove('hidden');
          res.detail.focus();
        });
      });
    </script>
  </body>
</html>
